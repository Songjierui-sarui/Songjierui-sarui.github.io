<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åœ£è¯å¿«ä¹èŒœèŒœå…¬ä¸»</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000c18; /* æ›´æ·±é‚ƒçš„å¤œç©º */
            font-family: 'Microsoft YaHei', sans-serif;
            touch-action: none; /* ç¦æ­¢æ‰‹æœºåŒå‡»ç¼©æ”¾å’Œæ»šåŠ¨ */
            -webkit-tap-highlight-color: transparent; /* å»é™¤ç‚¹å‡»é«˜äº®å— */
        }
        canvas {
            display: block;
        }
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            z-index: 10;
        }
        .animate-tip {
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 80vh; /* æ”¾åœ¨å±å¹•ä¸‹æ–¹ */
            font-size: 14px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
            100% { opacity: 0.3; transform: scale(1); }
        }
    </style>
</head>
<body>
    <div id="ui-layer">
        <div class="animate-tip">ğŸ‘†å“ªæ€•åªæ˜¯è½»è½»ç‚¹å‡»ï¼Œä¹Ÿä¼šæœ‰å¥‡è¿¹å‘ç”Ÿâœ¨</div>
    </div>
    <canvas id="christmasCanvas"></canvas>

    <script>
        const canvas = document.getElementById('christmasCanvas');
        const ctx = canvas.getContext('2d');
        
        // ç¦»å±Canvasç”¨äºç¼“å­˜æ ‘ï¼Œé¿å…æ¯ä¸€å¸§é‡å¤è®¡ç®—åˆ†å½¢ï¼Œæå¤§çœç”µ
        const bgCanvas = document.createElement('canvas');
        const bgCtx = bgCanvas.getContext('2d');

        let width, height, scale;
        let particles = []; // çƒŸèŠ±ç²’å­
        let snows = [];     // é›ªèŠ±
        let lights = [];    // æ ‘ä¸Šçš„ç¯
        let stars = [];     // å¤©ä¸Šçš„æ˜Ÿæ˜Ÿ

        // Turtle ç»˜å›¾å˜é‡
        let tx, ty, tangle;

        // --- åˆå§‹åŒ–ä¸é€‚é…ç³»ç»Ÿ ---
        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            
            // è®¾ç½®é«˜æ¸…ç”»å¸ƒ (é˜²æ­¢æ‰‹æœºä¸Šæ¨¡ç³Š)
            const dpr = window.devicePixelRatio || 1;
            canvas.width = width * dpr;
            canvas.height = height * dpr;
            ctx.scale(dpr, dpr);
            
            // ç¦»å±Canvasä¹Ÿè¦å¯¹åº”è®¾ç½®
            bgCanvas.width = width * dpr;
            bgCanvas.height = height * dpr;
            bgCtx.scale(dpr, dpr);

            // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹ï¼šåŸºäºå±å¹•å®½åº¦ï¼Œä¿è¯åœ¨çª„å±æ‰‹æœºä¸Šæ ‘ä¸ä¼šå¤ªå¤§
            // å¦‚æœå±å¹•å®½åº¦å°äº500ï¼ˆæ‰‹æœºï¼‰ï¼Œåˆ™æ ‘çš„å¤§å°æ ¹æ®å®½åº¦åŠ¨æ€è°ƒæ•´
            scale = Math.min(width / 500, 1) * 0.9; 

            drawStaticScene();
        }

        // --- ç»˜å›¾å·¥å…·å‡½æ•° ---
        function t_moveTo(x, y) { tx = x; ty = y; }
        function t_left(deg) { tangle -= deg; }
        function t_right(deg) { tangle += deg; }
        function t_forward(len, context, draw = true) {
            const rad = tangle * Math.PI / 180;
            const newX = tx + Math.cos(rad) * len;
            const newY = ty - Math.sin(rad) * len;
            if (draw) {
                context.beginPath();
                context.moveTo(tx, ty);
                context.lineTo(newX, newY);
                context.stroke();
            }
            tx = newX; ty = newY;
        }

        // é€’å½’ç”»æ ‘
        function tree(d, s) {
            if (d <= 0) return;
            t_forward(s, bgCtx);
            tree(d - 1, s * 0.82); // 0.82ç³»æ•°è®©æ ‘æ›´èŒ‚å¯†
            t_right(120);
            tree(d - 3, s * 0.5);
            
            // åœ¨åˆ†æ”¯å¤„è®°å½•å½©ç¯ä½ç½®
            if (d > 2 && Math.random() < 0.15) {
                lights.push({
                    x: tx, y: ty,
                    color: Math.random() > 0.6 ? '#ff4757' : (Math.random() > 0.5 ? '#ffa502' : '#ffffff'),
                    offset: Math.random() * Math.PI * 2
                });
            }

            t_right(120);
            tree(d - 3, s * 0.5);
            t_right(120);
            t_forward(-s, bgCtx, false);
        }

        // --- ç»˜åˆ¶é™æ€åœºæ™¯ (åªæ‰§è¡Œä¸€æ¬¡) ---
        function drawStaticScene() {
            lights = []; 
            bgCtx.clearRect(0, 0, width, height);

            // 1. ç¡®å®šæ ‘çš„ä¸­å¿ƒä½ç½® (å±å¹•åº•éƒ¨åä¸Š)
            const treeBaseX = width / 2;
            const treeBaseY = height - 100 * scale - 50; 

            // 2. ç”»æ ‘
            bgCtx.strokeStyle = '#2f3640'; // æ ‘å¹²æ·±è‰²
            bgCtx.lineWidth = 4 * scale;
            bgCtx.lineCap = 'round';
            
            tx = treeBaseX; ty = treeBaseY; tangle = 90;
            // åªæœ‰è¿™é‡Œç”¨ç»¿è‰²ç”»çº¿
            bgCtx.strokeStyle = '#006400';
            tree(13, 90 * scale); 

            // 3. ç”»å¤§æ˜Ÿæ˜Ÿ
            bgCtx.save();
            bgCtx.translate(treeBaseX, treeBaseY - 420 * scale);
            bgCtx.scale(scale, scale);
            bgCtx.beginPath();
            bgCtx.fillStyle = '#ffec99';
            bgCtx.shadowColor = '#ffec99';
            bgCtx.shadowBlur = 20;
            for(let i=0; i<5; i++){
                bgCtx.lineTo(Math.cos((18+i*72)/180*Math.PI)*25, -Math.sin((18+i*72)/180*Math.PI)*25);
                bgCtx.lineTo(Math.cos((54+i*72)/180*Math.PI)*10, -Math.sin((54+i*72)/180*Math.PI)*10);
            }
            bgCtx.fill();
            bgCtx.restore();

            // 4. ç”»é›ªäºº (å·¦å³å„ä¸€ä¸ª)
            drawSnowMan(treeBaseX - 100 * scale, treeBaseY + 20, 0.7 * scale);
            drawSnowMan(treeBaseX + 100 * scale, treeBaseY + 20, 0.6 * scale);

            // 5. åˆå§‹åŒ–é›ªèŠ±
            snows = [];
            for(let i=0; i<100; i++) {
                snows.push(createSnow());
            }
        }

        function drawSnowMan(x, y, s) {
            bgCtx.save();
            bgCtx.translate(x, y);
            bgCtx.scale(s, s);
            bgCtx.fillStyle = 'white';
            bgCtx.beginPath(); bgCtx.arc(0, 0, 30, 0, Math.PI*2); bgCtx.fill(); // èº«
            bgCtx.beginPath(); bgCtx.arc(0, -45, 20, 0, Math.PI*2); bgCtx.fill(); // å¤´
            bgCtx.fillStyle = 'tomato'; bgCtx.beginPath(); bgCtx.arc(0, -15, 3, 0, Math.PI*2); bgCtx.fill(); // çº½æ‰£
            bgCtx.restore();
        }

        function createSnow() {
            return {
                x: Math.random() * width,
                y: Math.random() * height,
                r: Math.random() * 2 + 1,
                v: Math.random() * 1 + 0.5
            };
        }

        // --- åŠ¨ç”»ç³»ç»Ÿ ---
        
        // çƒŸèŠ±ç²’å­ç±»
        class Firework {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.life = 1;
                this.color = `hsl(${Math.random()*360}, 100%, 70%)`;
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 4 + 2;
                this.vx = Math.cos(angle) * speed;
                this.vy = Math.sin(angle) * speed;
            }
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += 0.05; // é‡åŠ›
                this.life -= 0.02;
                this.vx *= 0.95; // é˜»åŠ›
                this.vy *= 0.95;
            }
            draw() {
                ctx.globalAlpha = this.life;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, 3, 0, Math.PI*2);
                ctx.fill();
                ctx.globalAlpha = 1;
            }
        }

        function animate(now) {
            ctx.clearRect(0, 0, width, height);
            
            // 1. ç»˜åˆ¶èƒŒæ™¯å±‚
            ctx.drawImage(bgCanvas, 0, 0, width, height);

            // 2. ç»˜åˆ¶é—ªçƒçš„å½©ç¯ (éœ“è™¹æ•ˆæœ)
            lights.forEach(l => {
                const flicker = Math.sin(now * 0.003 + l.offset);
                if (flicker > 0) {
                    ctx.beginPath();
                    ctx.arc(l.x, l.y, 3 * scale + flicker * 2, 0, Math.PI*2);
                    ctx.fillStyle = l.color;
                    ctx.shadowColor = l.color;
                    ctx.shadowBlur = 10;
                    ctx.fill();
                    ctx.shadowBlur = 0;
                }
            });

            // 3. ç»˜åˆ¶æ–‡å­— (ä½ç½®å›ºå®šåœ¨ä¸Šæ–¹)
            const fontSize = Math.min(width / 10, 40); // å­—ä½“å¤§å°éšå±å¹•å˜
            ctx.font = `bold ${fontSize}px "Microsoft YaHei", sans-serif`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // æ–‡å­—å…‰æ™•
            const glow = Math.abs(Math.sin(now * 0.001));
            ctx.shadowColor = '#e84393';
            ctx.shadowBlur = 15 * glow;
            ctx.fillStyle = '#ff7675';
            ctx.fillText("åœ£è¯å¿«ä¹èŒœèŒœå…¬ä¸»ï¼", width / 2, height * 0.15);
            ctx.shadowBlur = 0;

            // 4. é›ªèŠ±ä¸‹è½
            ctx.fillStyle = "rgba(255, 255, 255, 0.8)";
            snows.forEach(s => {
                s.y += s.v;
                s.x += Math.sin(now * 0.001 + s.y*0.01) * 0.3;
                if(s.y > height) {
                    s.y = -5;
                    s.x = Math.random() * width;
                }
                ctx.beginPath();
                ctx.arc(s.x, s.y, s.r * scale, 0, Math.PI*2);
                ctx.fill();
            });

            // 5. çƒŸèŠ±å¤„ç†
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.update();
                p.draw();
                if (p.life <= 0) particles.splice(i, 1);
            }

            requestAnimationFrame(animate);
        }

        // --- äº¤äº’äº‹ä»¶ ---
        function createExplosion(x, y) {
            // éœ‡åŠ¨åé¦ˆ (å¦‚æœè®¾å¤‡æ”¯æŒ)
            if (navigator.vibrate) navigator.vibrate(15);
            
            // ç”Ÿæˆ30ä¸ªç²’å­
            for(let i=0; i<30; i++) {
                particles.push(new Firework(x, y));
            }
            
            // å¦‚æœç‚¹åœ¨æ ‘é™„è¿‘ï¼Œé¢å¤–åŠ ä¸€ç‚¹å½©ç¯é—ªçƒ (è§†è§‰æ¬ºéª—ï¼Œå…¶å®æ˜¯åŠ ä¸ªäº®æ–‘)
            if (y > height/2) {
                // å¯ä»¥åœ¨è¿™é‡ŒåŠ ç‰¹æ®ŠéŸ³æ•ˆé€»è¾‘
            }
        }

        // ç»Ÿä¸€å¤„ç†è§¦æ‘¸å’Œç‚¹å‡»
        function handleInput(e) {
            e.preventDefault(); // é˜²æ­¢åŒå‡»ç¼©æ”¾
            let clientX, clientY;
            
            if (e.type === 'touchstart') {
                // å¤šç‚¹è§¦æ§æ”¯æŒï¼šéå†æ‰€æœ‰è§¦æ‘¸ç‚¹
                for (let i = 0; i < e.changedTouches.length; i++) {
                    createExplosion(e.changedTouches[i].clientX, e.changedTouches[i].clientY);
                }
            } else {
                createExplosion(e.clientX, e.clientY);
            }
        }

        window.addEventListener('resize', resize);
        window.addEventListener('touchstart', handleInput, {passive: false});
        window.addEventListener('mousedown', handleInput);

        // å¯åŠ¨
        resize();
        animate(0);

    </script>
</body>
</html>